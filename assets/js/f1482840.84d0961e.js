"use strict";(self.webpackChunkethberry_github_io=self.webpackChunkethberry_github_io||[]).push([[7694],{15724:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>c,toc:()=>o});var a=t(74848),s=t(28453);const r={hide_table_of_contents:!0,sidebar_position:2},i="Purchasing raffle tickets",c={id:"game/mechanics-gambling/raffle/purchase",title:"Purchasing raffle tickets",description:"Purchasing raffle tickets from game website",source:"@site/api/game/mechanics-gambling/raffle/purchase.md",sourceDirName:"game/mechanics-gambling/raffle",slug:"/game/mechanics-gambling/raffle/purchase",permalink:"/api/game/mechanics-gambling/raffle/purchase",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{hide_table_of_contents:!0,sidebar_position:2},sidebar:"defaultSidebar",previous:{title:"Automated raffle rounds",permalink:"/api/game/mechanics-gambling/raffle/automation"},next:{title:"Miscellaneous",permalink:"/api/category/miscellaneous"}},l={},o=[{value:"Step 1: get raffle contract",id:"step-1-get-raffle-contract",level:4},{value:"Step 2: get raffle round",id:"step-2-get-raffle-round",level:4},{value:"Step 3: sign selling transaction",id:"step-3-sign-selling-transaction",level:4},{value:"Step 4: execute transaction in metamask",id:"step-4-execute-transaction-in-metamask",level:4}];function d(e){const n={code:"code",h1:"h1",h4:"h4",header:"header",p:"p",pre:"pre",...(0,s.RP)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"purchasing-raffle-tickets",children:"Purchasing raffle tickets"})}),"\n",(0,a.jsx)(n.p,{children:"Purchasing raffle tickets from game website"}),"\n",(0,a.jsx)(n.h4,{id:"step-1-get-raffle-contract",children:"Step 1: get raffle contract"}),"\n",(0,a.jsx)(n.p,{children:"Request"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"curl -X 'GET' \\\n  'https://game-api.ethberry.io/raffle/contracts?skip=0&take=25&chainId=10001' \\\n  -H 'accept: */*' \\\n  -H 'Authorization: Bearer 11111111-2222-3333-4444-555555555555'\n"})}),"\n",(0,a.jsx)(n.p,{children:"Response"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "rows": [\n    {\n      "id": 12201,\n      "createdAt": "2024-03-15T02:09:10.938Z",\n      "updatedAt": "2024-03-15T02:09:10.938Z",\n      "address": "0xfe3b557e8fb62b89f4916b721be55ceb828dbd73",\n      "chainId": 10001,\n      "title": "RAFFLE",\n      "description": "{\\"blocks\\":[{\\"key\\":\\"e9n5e\\",\\"text\\":\\"bold\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":4,\\"style\\":\\"BOLD\\"}],\\"entityRanges\\":[],\\"data\\":{}},{\\"key\\":\\"dfijs\\",\\"text\\":\\"italic\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":6,\\"style\\":\\"ITALIC\\"}],\\"entityRanges\\":[],\\"data\\":{}},{\\"key\\":\\"fdeqa\\",\\"text\\":\\"underscore\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":10,\\"style\\":\\"UNDERLINE\\"}],\\"entityRanges\\":[],\\"data\\":{}},{\\"key\\":\\"4uhh1\\",\\"text\\":\\"strikethrough\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":13,\\"style\\":\\"STRIKETHROUGH\\"}],\\"entityRanges\\":[],\\"data\\":{}}],\\"entityMap\\":{}}",\n      "merchantId": 1,\n      "imageUrl": "https://firebasestorage.googleapis.com/v0/b/gemunion-firebase.appspot.com/o/DO_NOT_REMOVE%2Flogo.png?alt=media&token=73cdfd99-1374-45e0-8140-5c02fc4d8097",\n      "name": "Raffle",\n      "symbol": "",\n      "decimals": 0,\n      "fromBlock": 0,\n      "royalty": 0,\n      "baseTokenURI": "",\n      "parameters": {\n        "timeLagBeforeRelease": "100",\n        "commission": "30",\n        "schedule": "0 0 * * 6,0",\n        "roundId": 103\n      },\n      "isPaused": false,\n      "contractStatus": "ACTIVE",\n      "contractType": null,\n      "contractFeatures": [\n        "RANDOM",\n        "ALLOWANCE",\n        "PAUSABLE"\n      ],\n      "contractModule": "RAFFLE",\n      "contractSecurity": "ACCESS_CONTROL",\n      "merchant": {\n        "id": 1,\n        "wallet": "0xfe3b557e8fb62b89f4916b721be55ceb828dbd73"\n      }\n    }\n  ],\n  "count": 1\n}\n'})}),"\n",(0,a.jsx)(n.h4,{id:"step-2-get-raffle-round",children:"Step 2: get raffle round"}),"\n",(0,a.jsx)(n.p,{children:"Request"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"curl -X 'GET' \\\n  'https://game-api.ethberry.io/rounds/current?contractId=12201' \\\n  -H 'accept: */*' \\\n  -H 'Authorization: Bearer 11111111-2222-3333-4444-555555555555'\n"})}),"\n",(0,a.jsx)(n.p,{children:"Response"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "id": 103,\n  "createdAt": "2024-03-15T02:09:10.969Z",\n  "updatedAt": "2024-03-15T02:09:10.969Z",\n  "number": null,\n  "roundId": "103",\n  "contractId": 12201,\n  "ticketContractId": 12101,\n  "priceId": 102210003,\n  "maxTickets": 5,\n  "startTimestamp": "2024-03-16T02:09:10.969Z",\n  "endTimestamp": null,\n  "contract": {\n    "id": 12201,\n    "createdAt": "2024-03-15T02:09:10.938Z",\n    "updatedAt": "2024-03-15T02:09:10.938Z",\n    "address": "0xfe3b557e8fb62b89f4916b721be55ceb828dbd73",\n    "chainId": 10001,\n    "title": "RAFFLE",\n    "description": "{\\"blocks\\":[{\\"key\\":\\"e9n5e\\",\\"text\\":\\"bold\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":4,\\"style\\":\\"BOLD\\"}],\\"entityRanges\\":[],\\"data\\":{}},{\\"key\\":\\"dfijs\\",\\"text\\":\\"italic\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":6,\\"style\\":\\"ITALIC\\"}],\\"entityRanges\\":[],\\"data\\":{}},{\\"key\\":\\"fdeqa\\",\\"text\\":\\"underscore\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":10,\\"style\\":\\"UNDERLINE\\"}],\\"entityRanges\\":[],\\"data\\":{}},{\\"key\\":\\"4uhh1\\",\\"text\\":\\"strikethrough\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":13,\\"style\\":\\"STRIKETHROUGH\\"}],\\"entityRanges\\":[],\\"data\\":{}}],\\"entityMap\\":{}}",\n    "merchantId": 1,\n    "imageUrl": "https://firebasestorage.googleapis.com/v0/b/gemunion-firebase.appspot.com/o/DO_NOT_REMOVE%2Flogo.png?alt=media&token=73cdfd99-1374-45e0-8140-5c02fc4d8097",\n    "name": "Raffle",\n    "symbol": "",\n    "decimals": 0,\n    "fromBlock": 0,\n    "royalty": 0,\n    "baseTokenURI": "",\n    "parameters": {\n      "timeLagBeforeRelease": "100",\n      "commission": "30",\n      "schedule": "0 0 * * 6,0",\n      "roundId": 103\n    },\n    "isPaused": false,\n    "contractStatus": "ACTIVE",\n    "contractType": null,\n    "contractFeatures": [\n      "RANDOM",\n      "ALLOWANCE",\n      "PAUSABLE"\n    ],\n    "contractModule": "RAFFLE",\n    "contractSecurity": "ACCESS_CONTROL"\n  },\n  "ticketContract": {\n    "id": 12101,\n    "createdAt": "2024-03-15T02:09:10.923Z",\n    "updatedAt": "2024-03-15T02:09:10.923Z",\n    "address": "0xfe3b557e8fb62b89f4916b721be55ceb828dbd73",\n    "chainId": 10001,\n    "title": "RAFFLE TICKET",\n    "description": "{\\"blocks\\":[{\\"key\\":\\"e9n5e\\",\\"text\\":\\"bold\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":4,\\"style\\":\\"BOLD\\"}],\\"entityRanges\\":[],\\"data\\":{}},{\\"key\\":\\"dfijs\\",\\"text\\":\\"italic\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":6,\\"style\\":\\"ITALIC\\"}],\\"entityRanges\\":[],\\"data\\":{}},{\\"key\\":\\"fdeqa\\",\\"text\\":\\"underscore\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":10,\\"style\\":\\"UNDERLINE\\"}],\\"entityRanges\\":[],\\"data\\":{}},{\\"key\\":\\"4uhh1\\",\\"text\\":\\"strikethrough\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":13,\\"style\\":\\"STRIKETHROUGH\\"}],\\"entityRanges\\":[],\\"data\\":{}}],\\"entityMap\\":{}}",\n    "merchantId": 1,\n    "imageUrl": "https://firebasestorage.googleapis.com/v0/b/gemunion-firebase.appspot.com/o/DO_NOT_REMOVE%2Flogo.png?alt=media&token=73cdfd99-1374-45e0-8140-5c02fc4d8097",\n    "name": "RAFF",\n    "symbol": "RAFF721",\n    "decimals": 0,\n    "fromBlock": 0,\n    "royalty": 100,\n    "baseTokenURI": "http://localhost:3011/metadata/",\n    "parameters": {},\n    "isPaused": false,\n    "contractStatus": "ACTIVE",\n    "contractType": "ERC721",\n    "contractFeatures": [],\n    "contractModule": "RAFFLE",\n    "contractSecurity": "ACCESS_CONTROL"\n  },\n  "price": {\n    "id": 102210003,\n    "components": [\n      {\n        "id": 281,\n        "tokenType": "ERC20",\n        "contractId": 10201,\n        "templateId": 1020101,\n        "tokenId": null,\n        "amount": "1000000000000000000",\n        "contract": {\n          "id": 10201,\n          "createdAt": "2024-03-15T02:09:08.751Z",\n          "updatedAt": "2024-03-15T02:09:08.751Z",\n          "address": "0xfe3b557e8fb62b89f4916b721be55ceb828dbd73",\n          "chainId": 10001,\n          "title": "Space Credits",\n          "description": "{\\"blocks\\":[{\\"key\\":\\"e9n5e\\",\\"text\\":\\"bold\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":4,\\"style\\":\\"BOLD\\"}],\\"entityRanges\\":[],\\"data\\":{}},{\\"key\\":\\"dfijs\\",\\"text\\":\\"italic\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":6,\\"style\\":\\"ITALIC\\"}],\\"entityRanges\\":[],\\"data\\":{}},{\\"key\\":\\"fdeqa\\",\\"text\\":\\"underscore\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":10,\\"style\\":\\"UNDERLINE\\"}],\\"entityRanges\\":[],\\"data\\":{}},{\\"key\\":\\"4uhh1\\",\\"text\\":\\"strikethrough\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":13,\\"style\\":\\"STRIKETHROUGH\\"}],\\"entityRanges\\":[],\\"data\\":{}}],\\"entityMap\\":{}}",\n          "merchantId": 1,\n          "imageUrl": "https://firebasestorage.googleapis.com/v0/b/gemunion-framework-production.appspot.com/o/DO_NOT_REMOVE%2Fspace_credit.png?alt=media&token=b940fa35-78bd-4534-b015-6ee8e290506e",\n          "name": "Space Credits",\n          "symbol": "GEM20",\n          "decimals": 18,\n          "fromBlock": 0,\n          "royalty": 0,\n          "baseTokenURI": "",\n          "parameters": {},\n          "isPaused": false,\n          "contractStatus": "ACTIVE",\n          "contractType": "ERC20",\n          "contractFeatures": [],\n          "contractModule": "HIERARCHY",\n          "contractSecurity": "ACCESS_CONTROL"\n        },\n        "template": {\n          "id": 1020101,\n          "createdAt": "2024-03-15T02:09:08.850Z",\n          "updatedAt": "2024-03-15T02:09:08.850Z",\n          "title": "Space Credits",\n          "description": "{\\"blocks\\":[{\\"key\\":\\"e9n5e\\",\\"text\\":\\"bold\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":4,\\"style\\":\\"BOLD\\"}],\\"entityRanges\\":[],\\"data\\":{}},{\\"key\\":\\"dfijs\\",\\"text\\":\\"italic\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":6,\\"style\\":\\"ITALIC\\"}],\\"entityRanges\\":[],\\"data\\":{}},{\\"key\\":\\"fdeqa\\",\\"text\\":\\"underscore\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":10,\\"style\\":\\"UNDERLINE\\"}],\\"entityRanges\\":[],\\"data\\":{}},{\\"key\\":\\"4uhh1\\",\\"text\\":\\"strikethrough\\",\\"type\\":\\"unstyled\\",\\"depth\\":0,\\"inlineStyleRanges\\":[{\\"offset\\":0,\\"length\\":13,\\"style\\":\\"STRIKETHROUGH\\"}],\\"entityRanges\\":[],\\"data\\":{}}],\\"entityMap\\":{}}",\n          "imageUrl": "https://firebasestorage.googleapis.com/v0/b/gemunion-firebase.appspot.com/o/DO_NOT_REMOVE%2Flogo.png?alt=media&token=73cdfd99-1374-45e0-8140-5c02fc4d8097",\n          "priceId": null,\n          "cap": "0",\n          "amount": "1000000000000000000000",\n          "cid": null,\n          "templateStatus": "ACTIVE",\n          "contractId": 10201,\n          "tokens": [\n            {\n              "id": 102010101,\n              "createdAt": "2024-03-15T02:09:08.955Z",\n              "updatedAt": "2024-03-15T02:09:08.955Z",\n              "imageUrl": null,\n              "metadata": {},\n              "tokenId": "0",\n              "royalty": 0,\n              "cid": null,\n              "tokenStatus": "MINTED",\n              "templateId": 1020101\n            }\n          ]\n        }\n      }\n    ]\n  },\n  "ticketCount": 0\n}\n'})}),"\n",(0,a.jsx)(n.h4,{id:"step-3-sign-selling-transaction",children:"Step 3: sign selling transaction"}),"\n",(0,a.jsx)(n.p,{children:"Request"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"curl -X 'POST' \\\n  'https://game-api.ethberry.io/raffle/ticket/sign' \\\n  -H 'accept: */*' \\\n  -H 'Authorization: Bearer 11111111-2222-3333-4444-555555555555' \\\n  -H 'Content-Type: application/json' \\\n  -d '{\n  \"account\": \"0x7008594bB5764beDE9c0511b0E1322e7fC5048D3\",\n  \"referrer\": \"0x7008594bB5764beDE9c0511b0E1322e7fC5048D3\",\n  \"contractId\": 12201\n}'\n"})}),"\n",(0,a.jsx)(n.p,{children:"Response"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'{\n  "nonce": "0xa6095cfacc57731f5ce5f541b9e33ae6590817482c036d25d9528cc8ff992322",\n  "signature": "0x46ccfccbec0f50e980b27ae54e5e43fda92a50ce75987945c45d74e214c2d3ff02211d226ceaf882e651216a39617087f139949bcbe06298d523d396f88899851c",\n  "expiresAt": 0\n}\n'})}),"\n",(0,a.jsx)(n.h4,{id:"step-4-execute-transaction-in-metamask",children:"Step 4: execute transaction in metamask"}),"\n",(0,a.jsx)(n.p,{children:"Purchase function ABI"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",children:'[\n  {\n    "inputs": [\n      {\n        "components": [\n          {\n            "internalType": "uint256",\n            "name": "externalId",\n            "type": "uint256"\n          },\n          {\n            "internalType": "uint256",\n            "name": "expiresAt",\n            "type": "uint256"\n          },\n          {\n            "internalType": "bytes32",\n            "name": "nonce",\n            "type": "bytes32"\n          },\n          {\n            "internalType": "bytes32",\n            "name": "extra",\n            "type": "bytes32"\n          },\n          {\n            "internalType": "address",\n            "name": "receiver",\n            "type": "address"\n          },\n          {\n            "internalType": "address",\n            "name": "referrer",\n            "type": "address"\n          }\n        ],\n        "internalType": "struct Params",\n        "name": "params",\n        "type": "tuple"\n      },\n      {\n        "components": [\n          {\n            "internalType": "enum TokenType",\n            "name": "tokenType",\n            "type": "uint8"\n          },\n          {\n            "internalType": "address",\n            "name": "token",\n            "type": "address"\n          },\n          {\n            "internalType": "uint256",\n            "name": "tokenId",\n            "type": "uint256"\n          },\n          {\n            "internalType": "uint256",\n            "name": "amount",\n            "type": "uint256"\n          }\n        ],\n        "internalType": "struct Asset",\n        "name": "item",\n        "type": "tuple"\n      },\n      {\n        "components": [\n          {\n            "internalType": "enum TokenType",\n            "name": "tokenType",\n            "type": "uint8"\n          },\n          {\n            "internalType": "address",\n            "name": "token",\n            "type": "address"\n          },\n          {\n            "internalType": "uint256",\n            "name": "tokenId",\n            "type": "uint256"\n          },\n          {\n            "internalType": "uint256",\n            "name": "amount",\n            "type": "uint256"\n          }\n        ],\n        "internalType": "struct Asset",\n        "name": "price",\n        "type": "tuple"\n      },\n      {\n        "internalType": "bytes",\n        "name": "signature",\n        "type": "bytes"\n      }\n    ],\n    "name": "purchaseRaffle",\n    "outputs": [],\n    "stateMutability": "payable",\n    "type": "function"\n  }\n]\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'import { BigNumber, Contract, utils, ZeroAddress } from "ethers";\n\nconst instance = new Contract(ETHBERRY_EXCHNAGE_ADDR, RafflePurchaseABI, Signer);\n\nconst onClick = () => instance.purchaseRaffle(\n  {\n    externalId: round.id,\n    expiresAt: sign.expiresAt,\n    nonce: utils.arrayify(sign.nonce),\n    extra: utils.formatBytes32String("0x"),\n    receiver: round.contract.address,\n    referrer: ZeroAddress,\n  },\n  {\n    tokenType: Object.values(TokenType).indexOf(TokenType.ERC721),\n    token: round.ticketContract.address,\n    tokenId: "0",\n    amount: "1",\n  },\n  round.price.components.map(component => ({\n    tokenType: Object.values(TokenType).indexOf(component.tokenType),\n    token: component.contract.address,\n    tokenId: component.template.tokens[0].tokenId,\n    amount: component.amount,\n  }))[0],\n  sign.signature,\n  {\n    value: round.price.components.reduce((memo, current) => {\n      if (current.tokenType === TokenType.NATIVE) {\n        return memo.add(current.amount);\n      }\n      return memo;\n    }, BigNumber.from(0)),\n  },\n);\n'})})]})}function p(e={}){const{wrapper:n}={...(0,s.RP)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{RP:()=>r,xA:()=>c});var a=t(96540);const s=a.createContext({});function r(e){const n=a.useContext(s);return a.useMemo((()=>"function"==typeof e?e(n):{...n,...e}),[n,e])}const i={};function c({components:e,children:n,disableParentContext:t}){let c;return c=t?"function"==typeof e?e({}):e||i:r(e),a.createElement(s.Provider,{value:c},n)}}}]);